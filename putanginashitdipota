<?php
require 'require/dbconnection.php';
// convert dispatch table into json file 
$fetch = $conn->query("SELECT * FROM `dispatch`") or die(mysqli_error());
$data_points = array();
while($result = $fetch->fetch_array()){
$lat = $result['lat'];
$longi = $result['longi'];
$point = array('longi' => $longi, 'lat' => $lat);
array_push($data_points, $point);
}
$json_string = json_encode($data_points);
$file = 'file.json';
file_put_contents($file, $json_string);


//convert json file to csv file
$jsonFilename = 'file.json';
$json = file_get_contents($jsonFilename);
$array = json_decode($json, true);
$f = fopen('php://output', 'w');
$firstLineKeys = false;
fputcsv($f, array('lat', 'longi'));
foreach ($array as $line)
{
if (empty($firstLineKeys))
{
$firstLineKeys = array_keys($line);
fputcsv($f, $firstLineKeys);
$firstLineKeys = array_flip($firstLineKeys);
$f = fopen('file.csv', 'w');
}
// Using array_merge is important to maintain the order of keys acording to the first element
fputcsv($f, array_merge($firstLineKeys, $line));

}

?>